<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data Siswa - Dashboard Akademik</title>

    <link rel="stylesheet" href="style.css" />

    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container">
      <aside class="sidebar">
        <div class="sidebar-header">
          <h2>Akademik</h2>
        </div>
        <nav class="sidebar-nav">
          <ul>
            <li><a href="index.html">Beranda</a></li>
            <li class="nav-dropdown active">
              <a href="#" class="dropdown-toggle">Data</a>
              <ul class="dropdown-menu">
                <li><a href="data-siswa.html" class="active">Siswa</a></li>
                <li><a href="data-kelas.html">Kelas</a></li>
                <li><a href="data-jurusan.html">Jurusan</a></li>
              </ul>
            </li>
          </ul>
        </nav>
      </aside>

      <main class="main-content">
        <header class="header">
          <div class="header-logo">
            <h3>Data Siswa</h3>
          </div>
          <div class="header-profile">
            <div class="profile-icon">P</div>
            <span>Admin</span>
          </div>
        </header>

        <section class="content">
          <div class="content-header">
            <h1>Manajemen Data Siswa</h1>
            <button class="btn btn-primary" id="btn-tambah-siswa">
              Tambah Siswa
            </button>
          </div>

          <div class="data-table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>No</th>
                  <th>NIS</th>
                  <th>Nama Lengkap</th>
                  <th>Kelas</th>
                  <th>Jurusan</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </section>

        <footer class="footer">
          <p>Copyright &copy; 2025 10 PPLG 3</p>
        </footer>
      </main>
    </div>

    <div class="modal-overlay" id="siswa-modal">
      <div class="modal-container">
        <div class="modal-header">
          <h2 id="modal-title">Form Data Siswa</h2>
          <button class="close-button" id="close-modal">&times;</button>
        </div>
        <form id="siswa-form">
          <input type="hidden" id="edit-index" />
          <div class="form-group">
            <label for="nis">NIS</label>
            <input
              type="number"
              id="nis"
              required
              placeholder="Masukkan NIS siswa"
            />
          </div>
          <div class="form-group">
            <label for="nama">Nama Lengkap</label>
            <input
              type="text"
              id="nama"
              required
              placeholder="Masukkan nama lengkap"
            />
          </div>
          <div class="form-group">
            <label for="kelas">Kelas</label>
            <input type="text" id="kelas" required placeholder="Contoh: 10" />
          </div>
          <div class="form-group">
            <label for="jurusan">Jurusan</label>
            <input
              type="text"
              id="jurusan"
              required
              placeholder="Contoh: PPLG 3"
            />
          </div>
          <button
            type="submit"
            class="btn btn-primary"
            style="width: 100%; padding: 12px"
          >
            Simpan
          </button>
        </form>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // --- Bagian Navigasi Sidebar ---
        const dropdownToggle = document.querySelector(".dropdown-toggle");
        if (dropdownToggle) {
          dropdownToggle.addEventListener("click", function (event) {
            event.preventDefault();
            const parent = this.parentElement;
            parent.classList.toggle("active");
          });
        }

        // --- Variabel Global untuk DOM ---
        const dataTable = document.querySelector(".data-table tbody");
        const btnTambahSiswa = document.getElementById("btn-tambah-siswa");

        // --- Variabel untuk Modal (BARU) ---
        const modalOverlay = document.getElementById("siswa-modal");
        const modalTitle = document.getElementById("modal-title");
        const closeModalBtn = document.getElementById("close-modal");
        const siswaForm = document.getElementById("siswa-form");
        const editIndexInput = document.getElementById("edit-index");

        // --- Fungsi Utama Local Storage (Sama seperti sebelumnya) ---

        /**
         * Mengambil data siswa dari Local Storage dan merender tabel.
         */
        function muatData() {
          const dataTersimpan = localStorage.getItem("dataSiswa");
          // Hapus baris data yang ada di tabel
          dataTable.innerHTML = "";

          if (dataTersimpan) {
            const data = JSON.parse(dataTersimpan);
            if (data.length > 0) {
              data.forEach((item, index) => {
                const newRow = dataTable.insertRow();
                newRow.innerHTML = `
                  <td>${index + 1}</td>
                  <td>${item.nis}</td>
                  <td>${item.nama}</td>
                  <td>${item.kelas}</td>
                  <td>${item.jurusan}</td>
                  <td>
                    <button class="btn btn-edit" data-index="${index}">Edit</button>
                    <button class="btn btn-delete" data-index="${index}">Hapus</button>
                  </td>
                `;
              });
            } else {
              // Tampilkan pesan jika tidak ada data
              const newRow = dataTable.insertRow();
              newRow.innerHTML = `<td colspan="6" style="text-align: center;">Tidak ada data siswa.</td>`;
            }
          } else {
            // Tampilkan pesan jika local storage kosong
            const newRow = dataTable.insertRow();
            newRow.innerHTML = `<td colspan="6" style="text-align: center;">Tidak ada data siswa.</td>`;
          }
        }

        /**
         * Menyimpan data dari tabel ke Local Storage.
         */
        function simpanData() {
          const rows = dataTable.querySelectorAll("tr");
          const dataUntukDisimpan = [];

          // Cek jika baris berisi pesan "Tidak ada data"
          if (rows.length === 1 && rows[0].querySelector('td[colspan="6"]')) {
            localStorage.setItem("dataSiswa", JSON.stringify([]));
            return;
          }

          rows.forEach((row) => {
            const cells = row.querySelectorAll("td");
            const dataSiswa = {
              nis: cells[1].textContent,
              nama: cells[2].textContent,
              kelas: cells[3].textContent,
              jurusan: cells[4].textContent,
            };
            dataUntukDisimpan.push(dataSiswa);
          });

          localStorage.setItem("dataSiswa", JSON.stringify(dataUntukDisimpan));
          // Muat ulang data untuk memastikan nomor urut dan tampilan konsisten
          muatData();
        }

        // Panggil fungsi muatData() saat halaman pertama kali dibuka
        muatData();

        // --- Logika Modal (BARU) ---

        // --- Logika Modal (Diperbarui untuk Animasi) ---

        function bukaModal(mode, data = {}, index = -1) {
          siswaForm.reset(); // Bersihkan form
          if (mode === "tambah") {
            modalTitle.textContent = "Tambah Data Siswa";
            editIndexInput.value = -1;
          } else if (mode === "edit") {
            modalTitle.textContent = "Edit Data Siswa";
            document.getElementById("nis").value = data.nis;
            document.getElementById("nama").value = data.nama;
            document.getElementById("kelas").value = data.kelas;
            document.getElementById("jurusan").value = data.jurusan;
            editIndexInput.value = index;
          }
          // Ganti .remove("hidden") menjadi .add("show")
          modalOverlay.classList.add("show");
        }

        function tutupModal() {
          // Ganti .add("hidden") menjadi .remove("show")
          modalOverlay.classList.remove("show");
        }

        // Event listener untuk membuka modal tambah
        btnTambahSiswa.addEventListener("click", () => bukaModal("tambah"));

        // Event listener untuk menutup modal
        closeModalBtn.addEventListener("click", tutupModal);
        modalOverlay.addEventListener("click", (event) => {
          if (event.target === modalOverlay) {
            tutupModal();
          }
        });

        // Event listener untuk form submission (Tambah & Edit)
        siswaForm.addEventListener("submit", function (event) {
          event.preventDefault(); // Mencegah form reload halaman

          const dataBaru = {
            nis: document.getElementById("nis").value,
            nama: document.getElementById("nama").value,
            kelas: document.getElementById("kelas").value,
            jurusan: document.getElementById("jurusan").value,
          };

          const indexToEdit = parseInt(editIndexInput.value);

          if (indexToEdit === -1) {
            // Mode Tambah
            const dataTersimpan =
              JSON.parse(localStorage.getItem("dataSiswa")) || [];
            dataTersimpan.push(dataBaru);
            localStorage.setItem("dataSiswa", JSON.stringify(dataTersimpan));
          } else {
            // Mode Edit
            const dataTersimpan = JSON.parse(localStorage.getItem("dataSiswa"));
            dataTersimpan[indexToEdit] = dataBaru;
            localStorage.setItem("dataSiswa", JSON.stringify(dataTersimpan));
          }

          muatData(); // Render ulang tabel dengan data baru
          tutupModal(); // Tutup modal setelah submit
        });

        // --- Modifikasi Logika Aksi agar Terintegrasi dengan Modal & Local Storage ---

        // Event listener untuk tombol "Edit" dan "Hapus" pada tabel
        dataTable.addEventListener("click", function (event) {
          if (event.target.classList.contains("btn-edit")) {
            const index = event.target.dataset.index;
            const dataTersimpan = JSON.parse(localStorage.getItem("dataSiswa"));
            const dataSiswa = dataTersimpan[index];
            bukaModal("edit", dataSiswa, index);
          } else if (event.target.classList.contains("btn-delete")) {
            const index = event.target.dataset.index;
            hapusSiswa(index);
          }
        });

        // Fungsi untuk menghapus data siswa
        function hapusSiswa(index) {
          const dataTersimpan = JSON.parse(localStorage.getItem("dataSiswa"));
          const namaSiswa = dataTersimpan[index].nama;

          if (
            confirm(
              `Apakah Anda yakin ingin menghapus data siswa bernama ${namaSiswa}?`
            )
          ) {
            dataTersimpan.splice(index, 1); // Hapus data dari array
            localStorage.setItem("dataSiswa", JSON.stringify(dataTersimpan)); // Simpan array baru
            muatData(); // Muat ulang data di tabel
          }
        }
      });
    </script>
  </body>
</html>
